import java.sql.*;
import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import javax.swing.event.*;
import javax.swing.table.DefaultTableModel;

public class SearchPrice extends JFrame {
	Search search = new Search();
	DefaultTableModel m = (DefaultTableModel)search.table.getModel();
	private PreparedStatement pstmt;
	private ResultSet rset;
	
	private String type;
	private int minPrice, maxPrice; 
	private String area;
	

	public void setArea(String area) {
		this.area = area;
	}
	
	public void setType(String type) {
		this.type = type;
	}
	
	public void setPrice(int minPrice, int maxPrice) { 
	  	this.minPrice = minPrice;
	  	this.maxPrice = maxPrice;
		}
	
	public String[][] searchResult() {
		try {   Connection conn = DriverManager.getConnection(
				"jdbc:mysql://localhost:3306/db2022team11", "db2022team11", "db2022team11");
				Statement stmt = conn.createStatement();
				
				
					try { //transaction
						conn.setAutoCommit(false);
						//검색 쿼리
						pstmt = conn.prepareStatement("select rent_type, price, deposit, building_name, building_type, sale_date, address from DB2022_SALE join "
								+area+ " on DB2022_SALE.building_id = "+area+".building_id where rent_type = ? and price >= ? and price <= ? "); 
						pstmt.setString(1, type);
						pstmt.setInt(2, minPrice);
						pstmt.setInt(3, maxPrice);
					    rset = pstmt.executeQuery();
					    
					    int i=0;
					    String [][]record = new String[i][7];
						//검색 결과 출력
						while(rset.next()) {
				
							record[i][0] = rset.getString("rent_type");
							record[i][1] = Integer.toString(rset.getInt("price"));
							record[i][2] = Integer.toString(rset.getInt("deposit"));
							record[i][3] = rset.getString("building_name");
							record[i][4] = rset.getString("building_type");
							record[i][5] = rset.getString("sale_date");
							record[i][6] = rset.getString("address");
							i++;
							//m.addRow(record);
						}
						conn.commit();
						return record;
					} catch(SQLException se) {
						se.printStackTrace();
						System.out.println("Rolling back data here");
							try {	
									if(conn!=null)
									conn.rollback();
							}catch(SQLException se2) {
								se2.printStackTrace();
							}
					}
			
					conn.setAutoCommit(true);
		
		
		}catch(SQLException se) {
			se.printStackTrace();
		}
		
	}
	
	
}

